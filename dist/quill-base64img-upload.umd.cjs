(function(i,a){typeof exports=="object"&&typeof module<"u"?a(exports,require("quill")):typeof define=="function"&&define.amd?define(["exports","quill"],a):(i=typeof globalThis<"u"?globalThis:i||self,a(i["quill-base64img-upload"]={},i.Quill))})(this,function(i,a){"use strict";const r=new Map;function f(o){return new Promise((s,n)=>{const e=new Image;e.src=o,e.onload=function(){const t=document.createElement("canvas");t.width=e.naturalWidth,t.height=e.naturalHeight,t.getContext("2d").drawImage(e,0,0,t.width,t.height),t.toBlob(function(c){s(c)},"image/webp",.8)}})}function g(o,s){o.on(a.events.EDITOR_CHANGE,async()=>{const n=o.getContents();for(const e of n.ops)if(typeof e.insert=="object"&&e.insert.image){const t=e.insert.image;if(t.startsWith("data:image")&&!r.has(t)){r.set(e.insert.image,"");const d=await f(t);s.upload(d).then(c=>{r.set(t,c)})}}})}const l=o=>{const s=o.getContents();for(const n of s.ops)if(typeof n.insert=="object"&&n.insert.image&&typeof n.insert.image=="string"&&n.insert.image.startsWith("data:image")){const e=n.insert.image;r.has(e)&&(n.insert.image=r.get(e))}return s};i.Base64Uploader=g,i.getUploadedContents=l,Object.defineProperty(i,Symbol.toStringTag,{value:"Module"})});
